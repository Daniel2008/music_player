# 桌面端音乐播放器技术架构设计

## 1. 技术栈选型

### 1.1 核心技术栈
| 类别 | 技术/框架 | 版本 | 选型理由 |
|------|-----------|------|----------|
| 基础框架 | Electron | ^28.0.0 | 跨平台桌面应用开发，基于Chromium和Node.js，支持Windows/macOS/Linux |
| UI框架 | React | ^18.2.0 | 组件化开发，虚拟DOM，良好的生态系统 |
| 构建工具 | Vite | ^5.0.8 | 快速的开发体验，支持热模块替换，适合React项目 |
| 状态管理 | Redux Toolkit | ^2.0.0 | 简化Redux使用，提供RTK Query用于API请求 |
| UI组件库 | Ant Design | ^5.12.0 | 丰富的UI组件，支持主题定制，适合快速开发 |
| 样式方案 | Styled Components | ^6.1.0 | CSS-in-JS，支持主题切换，组件级样式隔离 |
| 图标库 | React Icons | ^4.12.0 | 丰富的图标集，支持多种图标库 |
| 动画库 | Framer Motion | ^10.16.0 | 流畅的动画效果，易于集成到React项目 |

### 1.2 音频处理技术
| 类别 | 技术/库 | 版本 | 选型理由 |
|------|-----------|------|----------|
| 音频解码 | howler.js | ^2.2.4 | Web Audio API封装，支持多种音频格式，跨平台兼容 |
| 音频元数据 | music-metadata | ^7.14.0 | 解析音频文件的ID3标签，支持多种格式 |
| 音频可视化 | wavesurfer.js | ^7.6.0 | 音频波形可视化，支持实时渲染 |

### 1.3 其他依赖
| 类别 | 技术/库 | 版本 | 选型理由 |
|------|-----------|------|----------|
| 文件系统 | fs-extra | ^11.2.0 | Node.js文件系统扩展，提供更方便的文件操作API |
| 路径处理 | path | 内置 | Node.js内置模块，处理文件路径 |
| 事件总线 | eventemitter3 | ^5.0.0 | 轻量级事件总线，用于组件间通信 |
| 本地存储 | electron-store | ^8.1.0 | Electron应用的本地存储解决方案 |
| 快捷键 | electron-localshortcut | ^3.2.1 | Electron全局快捷键管理 |

## 2. 系统架构设计

### 2.1 架构概述
采用分层架构设计，将系统分为表现层、业务逻辑层、数据层和基础设施层，各层之间通过明确的接口进行通信，实现高内聚低耦合。

### 2.2 分层架构图
```
┌─────────────────────────────────────────────────────────────────────┐
│                           表现层 (UI Layer)                         │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │   主窗口    │  │   迷你模式   │  │   全屏模式   │  │   设置面板   │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  播放控制   │  │   音乐列表   │  │   歌词显示   │  │   主题切换   │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
│                                API                                 │
└─────────────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────────────┐
│                        业务逻辑层 (Logic Layer)                     │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  播放引擎   │  │  音乐库管理  │  │  播放列表管理 │  │  在线音乐服务 │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  音效处理   │  │  歌词管理   │  │  主题管理   │  │  快捷键管理  │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
│                                API                                 │
└─────────────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────────────┐
│                           数据层 (Data Layer)                       │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  本地数据库  │  │  音频元数据  │  │  用户配置   │  │  播放历史   │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
│                                API                                 │
└─────────────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────────────┐
│                        基础设施层 (Infrastructure Layer)           │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  文件系统   │  │  网络请求   │  │  事件总线   │  │  日志系统   │ │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

### 2.3 核心模块关系图
```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   UI组件     │────▶│  业务逻辑层   │────▶│   数据层     │
└─────────────┘     └─────────────┘     └─────────────┘
        ▲                   ▲                   ▲
        │                   │                   │
        └───────────────────┼───────────────────┘
                            │
                        ┌─────────────┐
                        │  基础设施层   │
                        └─────────────┘
```

## 3. 核心模块设计

### 3.1 播放引擎模块

#### 3.1.1 功能描述
负责音频文件的加载、解码、播放控制和音效处理，是整个播放器的核心模块。

#### 3.1.2 核心类与方法

| 类/方法 | 描述 | 参数 | 返回值 |
|---------|------|------|--------|
| `AudioPlayer` | 音频播放器核心类 | - | - |
| `load(filePath)` | 加载音频文件 | `filePath`: string - 音频文件路径 | `Promise<AudioMetadata>` - 音频元数据 |
| `play()` | 播放音频 | - | `Promise<void>` |
| `pause()` | 暂停音频 | - | `Promise<void>` |
| `stop()` | 停止音频 | - | `Promise<void>` |
| `next()` | 播放下一曲 | - | `Promise<void>` |
| `previous()` | 播放上一曲 | - | `Promise<void>` |
| `seek(time)` | 跳转到指定时间 | `time`: number - 时间（秒） | `Promise<void>` |
| `setVolume(volume)` | 设置音量 | `volume`: number - 音量（0-1） | `void` |
| `setPlaybackRate(rate)` | 设置播放速率 | `rate`: number - 播放速率（0.5-2） | `void` |
| `setEqualizer(frequencies)` | 设置均衡器 | `frequencies`: number[] - 频率增益 | `void` |
| `getCurrentTime()` | 获取当前播放时间 | - | `number` - 当前时间（秒） |
| `getDuration()` | 获取音频总时长 | - | `number` - 总时长（秒） |
| `getState()` | 获取播放状态 | - | `'idle' \| 'loading' \| 'playing' \| 'paused' \| 'ended'` |

#### 3.1.3 状态管理
```javascript
// Redux slice for player state
const playerSlice = createSlice({
  name: 'player',
  initialState: {
    currentTrack: null,
    isPlaying: false,
    volume: 0.8,
    currentTime: 0,
    duration: 0,
    playbackRate: 1,
    repeatMode: 'none', // none, one, all
    shuffle: false,
    equalizer: [],
    state: 'idle' // idle, loading, playing, paused, ended
  },
  reducers: {
    // 播放控制相关action
  }
});
```

### 3.2 音乐库管理模块

#### 3.2.1 功能描述
负责本地音乐文件的扫描、索引、分类和搜索，以及在线音乐的集成。

#### 3.2.2 核心类与方法

| 类/方法 | 描述 | 参数 | 返回值 |
|---------|------|------|--------|
| `MusicLibrary` | 音乐库管理核心类 | - | - |
| `scanDirectories(directories)` | 扫描指定目录 | `directories`: string[] - 目录路径数组 | `Promise<Track[]>` - 扫描到的歌曲列表 |
| `getTracks()` | 获取所有歌曲 | - | `Track[]` - 歌曲列表 |
| `getTrackById(id)` | 根据ID获取歌曲 | `id`: string - 歌曲ID | `Track \| null` - 歌曲对象 |
| `getTracksByArtist(artist)` | 根据艺术家获取歌曲 | `artist`: string - 艺术家名称 | `Track[]` - 歌曲列表 |
| `getTracksByAlbum(album)` | 根据专辑获取歌曲 | `album`: string - 专辑名称 | `Track[]` - 歌曲列表 |
| `getTracksByGenre(genre)` | 根据流派获取歌曲 | `genre`: string - 流派名称 | `Track[]` - 歌曲列表 |
| `search(query)` | 搜索歌曲 | `query`: string - 搜索关键词 | `Track[]` - 匹配的歌曲列表 |
| `refresh()` | 刷新音乐库 | - | `Promise<Track[]>` - 刷新后的歌曲列表 |

#### 3.2.3 数据模型
```typescript
interface Track {
  id: string; // 唯一标识符
  title: string; // 歌曲标题
  artist: string; // 艺术家
  album: string; // 专辑
  genre: string; // 流派
  year: number; // 发行年份
  duration: number; // 时长（秒）
  filePath: string; // 文件路径
  coverPath?: string; // 封面路径
  lyricsPath?: string; // 歌词文件路径
  bitrate: number; // 比特率
  sampleRate: number; // 采样率
  channels: number; // 声道数
  createdAt: number; // 添加时间戳
  playCount: number; // 播放次数
}
```

### 3.3 播放列表管理模块

#### 3.3.1 功能描述
负责播放列表的创建、编辑、删除和管理，支持拖拽排序和批量操作。

#### 3.3.2 核心类与方法

| 类/方法 | 描述 | 参数 | 返回值 |
|---------|------|------|--------|
| `PlaylistManager` | 播放列表管理核心类 | - | - |
| `createPlaylist(name)` | 创建播放列表 | `name`: string - 播放列表名称 | `Playlist` - 新创建的播放列表 |
| `deletePlaylist(id)` | 删除播放列表 | `id`: string - 播放列表ID | `boolean` - 是否删除成功 |
| `renamePlaylist(id, newName)` | 重命名播放列表 | `id`: string - 播放列表ID<br>`newName`: string - 新名称 | `Playlist` - 重命名后的播放列表 |
| `getPlaylists()` | 获取所有播放列表 | - | `Playlist[]` - 播放列表列表 |
| `getPlaylistById(id)` | 根据ID获取播放列表 | `id`: string - 播放列表ID | `Playlist \| null` - 播放列表对象 |
| `addTrackToPlaylist(playlistId, trackId)` | 添加歌曲到播放列表 | `playlistId`: string - 播放列表ID<br>`trackId`: string - 歌曲ID | `Playlist` - 更新后的播放列表 |
| `removeTrackFromPlaylist(playlistId, trackId)` | 从播放列表移除歌曲 | `playlistId`: string - 播放列表ID<br>`trackId`: string - 歌曲ID | `Playlist` - 更新后的播放列表 |
| `reorderTracks(playlistId, trackIds)` | 重新排序播放列表歌曲 | `playlistId`: string - 播放列表ID<br>`trackIds`: string[] - 歌曲ID排序后的数组 | `Playlist` - 更新后的播放列表 |

#### 3.3.3 数据模型
```typescript
interface Playlist {
  id: string; // 唯一标识符
  name: string; // 播放列表名称
  tracks: string[]; // 歌曲ID数组
  createdAt: number; // 创建时间戳
  updatedAt: number; // 更新时间戳
  coverPath?: string; // 封面路径
}
```

### 3.4 歌词管理模块

#### 3.4.1 功能描述
负责歌词文件的解析、同步显示和在线歌词匹配，支持多种歌词格式。

#### 3.4.2 核心类与方法

| 类/方法 | 描述 | 参数 | 返回值 |
|---------|------|------|--------|
| `LyricsManager` | 歌词管理核心类 | - | - |
| `parseLRC(content)` | 解析LRC格式歌词 | `content`: string - LRC歌词内容 | `Lyrics` - 解析后的歌词对象 |
| `loadLyrics(track)` | 加载歌曲歌词 | `track`: Track - 歌曲对象 | `Promise<Lyrics \| null>` - 歌词对象或null |
| `searchOnlineLyrics(track)` | 在线搜索歌词 | `track`: Track - 歌曲对象 | `Promise<Lyrics[]>` - 匹配的歌词列表 |
| `saveLyrics(track, lyrics)` | 保存歌词到本地 | `track`: Track - 歌曲对象<br>`lyrics`: Lyrics - 歌词对象 | `Promise<void>` |
| `getCurrentLyric(time)` | 获取当前时间的歌词 | `time`: number - 当前播放时间（秒） | `LyricLine \| null` - 当前歌词行 |
| `getNextLyric(time)` | 获取下一句歌词 | `time`: number - 当前播放时间（秒） | `LyricLine \| null` - 下一句歌词行 |

#### 3.4.3 数据模型
```typescript
interface LyricLine {
  time: number; // 歌词开始时间（秒）
  text: string; // 歌词文本
}

interface Lyrics {
  lines: LyricLine[]; // 歌词行数组
  title?: string; // 歌曲标题
  artist?: string; // 艺术家
  album?: string; // 专辑
  offset?: number; // 时间偏移（毫秒）
}
```

### 3.5 主题管理模块

#### 3.5.1 功能描述
负责主题的切换、自定义和保存，支持浅色/深色主题和基于专辑封面的动态主题。

#### 3.5.2 核心类与方法

| 类/方法 | 描述 | 参数 | 返回值 |
|---------|------|------|--------|
| `ThemeManager` | 主题管理核心类 | - | - |
| `loadThemes()` | 加载所有主题 | - | `Theme[]` - 主题列表 |
| `getCurrentTheme()` | 获取当前主题 | - | `Theme` - 当前主题 |
| `setTheme(themeId)` | 设置主题 | `themeId`: string - 主题ID | `Promise<void>` |
| `createTheme(theme)` | 创建自定义主题 | `theme`: Theme - 主题对象 | `Theme` - 新创建的主题 |
| `updateTheme(theme)` | 更新主题 | `theme`: Theme - 主题对象 | `Theme` - 更新后的主题 |
| `deleteTheme(themeId)` | 删除主题 | `themeId`: string - 主题ID | `boolean` - 是否删除成功 |
| `generateThemeFromCover(coverPath)` | 从封面生成主题 | `coverPath`: string - 封面图片路径 | `Theme` - 生成的主题 |

#### 3.5.3 数据模型
```typescript
interface Theme {
  id: string; // 唯一标识符
  name: string; // 主题名称
  type: 'light' \| 'dark' \| 'custom'; // 主题类型
  colors: {
    primary: string; // 主色
    secondary: string; // 辅助色
    background: string; // 背景色
    secondaryBackground: string; // 次级背景色
    text: string; // 文本主色
    secondaryText: string; // 文本次级色
    border: string; // 边框色
    success: string; // 成功色
    warning: string; // 警告色
    error: string; // 错误色
  };
  isDefault?: boolean; // 是否为默认主题
}
```

## 4. API设计

### 4.1 本地音乐API

#### 4.1.1 扫描本地音乐
```
POST /api/local-music/scan
```

**请求参数**：
```json
{
  "directories": ["D:/Music", "E:/My Music"]
}
```

**响应**：
```json
{
  "success": true,
  "data": {
    "tracks": [/* Track对象数组 */],
    "count": 120
  }
}
```

#### 4.1.2 获取音乐库
```
GET /api/local-music/library
```

**查询参数**：
- `filter`: 可选，过滤条件（如`artist:周杰伦`）
- `sortBy`: 可选，排序字段（如`title`、`artist`、`album`、`year`）
- `orderBy`: 可选，排序方向（`asc`或`desc`）

**响应**：
```json
{
  "success": true,
  "data": {
    "tracks": [/* Track对象数组 */],
    "total": 120
  }
}
```

#### 4.1.3 搜索本地音乐
```
GET /api/local-music/search
```

**查询参数**：
- `query`: 必需，搜索关键词
- `limit`: 可选，返回结果数量限制

**响应**：
```json
{
  "success": true,
  "data": {
    "tracks": [/* Track对象数组 */],
    "total": 15
  }
}
```

### 4.2 播放列表API

#### 4.2.1 获取所有播放列表
```
GET /api/playlists
```

**响应**：
```json
{
  "success": true,
  "data": [/* Playlist对象数组 */]
}
```

#### 4.2.2 创建播放列表
```
POST /api/playlists
```

**请求参数**：
```json
{
  "name": "我的收藏",
  "tracks": ["track1", "track2"]
}
```

**响应**：
```json
{
  "success": true,
  "data": {/* Playlist对象 */}
}
```

#### 4.2.3 获取播放列表详情
```
GET /api/playlists/:id
```

**响应**：
```json
{
  "success": true,
  "data": {
    "playlist": {/* Playlist对象 */},
    "tracks": [/* Track对象数组 */]
  }
}
```

### 4.3 播放控制API

#### 4.3.1 获取播放状态
```
GET /api/player/status
```

**响应**：
```json
{
  "success": true,
  "data": {
    "currentTrack": {/* Track对象 */},
    "isPlaying": true,
    "volume": 0.8,
    "currentTime": 120,
    "duration": 300,
    "playbackRate": 1,
    "repeatMode": "none",
    "shuffle": false,
    "state": "playing"
  }
}
```

#### 4.3.2 播放/暂停
```
POST /api/player/play-pause
```

**响应**：
```json
{
  "success": true,
  "data": {
    "isPlaying": true
  }
}
```

#### 4.3.3 播放指定歌曲
```
POST /api/player/play-track
```

**请求参数**：
```json
{
  "trackId": "track1",
  "playlistId": "playlist1" // 可选，播放列表ID
}
```

**响应**：
```json
{
  "success": true,
  "data": {
    "currentTrack": {/* Track对象 */}
  }
}
```

### 4.4 歌词API

#### 4.4.1 获取歌曲歌词
```
GET /api/lyrics/:trackId
```

**响应**：
```json
{
  "success": true,
  "data": {/* Lyrics对象 */}
}
```

#### 4.4.2 在线搜索歌词
```
POST /api/lyrics/search
```

**请求参数**：
```json
{
  "title": "歌曲标题",
  "artist": "艺术家",
  "album": "专辑" // 可选
}
```

**响应**：
```json
{
  "success": true,
  "data": [/* Lyrics对象数组 */]
}
```

## 5. 数据库设计

### 5.1 数据库选型
采用SQLite作为本地数据库，轻量级、无需服务器、跨平台兼容，适合桌面应用。

### 5.2 数据库表结构

#### 5.2.1 `tracks`表 - 歌曲信息
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| `id` | `TEXT` | `PRIMARY KEY` | 歌曲唯一标识符 |
| `title` | `TEXT` | `NOT NULL` | 歌曲标题 |
| `artist` | `TEXT` | | 艺术家 |
| `album` | `TEXT` | | 专辑 |
| `genre` | `TEXT` | | 流派 |
| `year` | `INTEGER` | | 发行年份 |
| `duration` | `REAL` | `NOT NULL` | 时长（秒） |
| `file_path` | `TEXT` | `UNIQUE NOT NULL` | 文件路径 |
| `cover_path` | `TEXT` | | 封面路径 |
| `lyrics_path` | `TEXT` | | 歌词文件路径 |
| `bitrate` | `INTEGER` | | 比特率 |
| `sample_rate` | `INTEGER` | | 采样率 |
| `channels` | `INTEGER` | | 声道数 |
| `created_at` | `INTEGER` | `NOT NULL` | 添加时间戳 |
| `updated_at` | `INTEGER` | `NOT NULL` | 更新时间戳 |
| `play_count` | `INTEGER` | `DEFAULT 0` | 播放次数 |

#### 5.2.2 `playlists`表 - 播放列表
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| `id` | `TEXT` | `PRIMARY KEY` | 播放列表唯一标识符 |
| `name` | `TEXT` | `NOT NULL` | 播放列表名称 |
| `cover_path` | `TEXT` | | 封面路径 |
| `created_at` | `INTEGER` | `NOT NULL` | 创建时间戳 |
| `updated_at` | `INTEGER` | `NOT NULL` | 更新时间戳 |

#### 5.2.3 `playlist_tracks`表 - 播放列表歌曲关联
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 关联ID |
| `playlist_id` | `TEXT` | `REFERENCES playlists(id) ON DELETE CASCADE` | 播放列表ID |
| `track_id` | `TEXT` | `REFERENCES tracks(id) ON DELETE CASCADE` | 歌曲ID |
| `position` | `INTEGER` | `NOT NULL` | 在播放列表中的位置 |
| `UNIQUE(playlist_id, track_id)` | | | 播放列表中歌曲唯一 |

#### 5.2.4 `play_history`表 - 播放历史
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | 历史记录ID |
| `track_id` | `TEXT` | `REFERENCES tracks(id) ON DELETE CASCADE` | 歌曲ID |
| `played_at` | `INTEGER` | `NOT NULL` | 播放时间戳 |
| `duration_played` | `REAL` | `NOT NULL` | 播放时长（秒） |

#### 5.2.5 `themes`表 - 主题
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| `id` | `TEXT` | `PRIMARY KEY` | 主题唯一标识符 |
| `name` | `TEXT` | `NOT NULL` | 主题名称 |
| `type` | `TEXT` | `NOT NULL CHECK(type IN ('light', 'dark', 'custom'))` | 主题类型 |
| `colors` | `TEXT` | `NOT NULL` | 主题颜色JSON字符串 |
| `is_default` | `INTEGER` | `DEFAULT 0 CHECK(is_default IN (0, 1))` | 是否为默认主题 |
| `created_at` | `INTEGER` | `NOT NULL` | 创建时间戳 |
| `updated_at` | `INTEGER` | `NOT NULL` | 更新时间戳 |

#### 5.2.6 `settings`表 - 用户设置
| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| `key` | `TEXT` | `PRIMARY KEY` | 设置键 |
| `value` | `TEXT` | `NOT NULL` | 设置值JSON字符串 |
| `updated_at` | `INTEGER` | `NOT NULL` | 更新时间戳 |

## 5. 系统配置与部署

### 5.1 开发环境配置

#### 5.1.1 安装依赖
```bash
npm install
```

#### 5.1.2 开发运行
```bash
npm run dev
```

#### 5.1.3 构建打包
```bash
# 构建Windows版本
npm run build:win

# 构建macOS版本
npm run build:mac

# 构建Linux版本
npm run build:linux
```

### 5.2 目录结构

```
├── src/
│   ├── main/              # Electron主进程代码
│   │   ├── index.js       # 主进程入口
│   │   ├── ipcHandlers.js # IPC事件处理
│   │   └── menu.js        # 应用菜单配置
│   ├── renderer/          # Electron渲染进程代码
│   │   ├── components/    # React组件
│   │   ├── hooks/         # 自定义Hooks
│   │   ├── pages/         # 页面组件
│   │   ├── redux/         # Redux状态管理
│   │   ├── services/      # API服务
│   │   ├── utils/         # 工具函数
│   │   ├── App.jsx        # 应用根组件
│   │   └── main.jsx       # 渲染进程入口
│   └── shared/            # 主进程和渲染进程共享代码
│       ├── constants.js   # 常量定义
│       ├── types.js       # TypeScript类型定义
│       └── utils.js       # 共享工具函数
├── public/                # 静态资源
├── assets/                # 应用资源（图标、图片等）
├── database/              # 数据库相关代码
├── scripts/               # 构建和部署脚本
├── package.json           # 项目配置
├── vite.config.js         # Vite配置
└── electron-builder.yml   # Electron Builder配置
```

### 5.3 关键配置文件

#### 5.3.1 `package.json`
```json
{
  "name": "music-player",
  "version": "1.0.0",
  "description": "A modern desktop music player",
  "main": "dist/main/index.js",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext js,jsx --report-unused-disable-directives --max-warnings 0",
    "build:win": "electron-builder --win",
    "build:mac": "electron-builder --mac",
    "build:linux": "electron-builder --linux"
  },
  "dependencies": {
    // 依赖列表
  },
  "devDependencies": {
    // 开发依赖列表
  }
}
```

#### 5.3.2 `vite.config.js`
```javascript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import electron from 'vite-plugin-electron';
import electronRenderer from 'vite-plugin-electron-renderer';

export default defineConfig({
  plugins: [
    react(),
    electron({
      entry: 'src/main/index.js',
    }),
    electronRenderer(),
  ],
  build: {
    outDir: 'dist',
    emptyOutDir: true,
  },
  server: {
    port: 3000,
  },
});
```

## 6. 性能优化

### 6.1 音频播放优化
- 使用Web Audio API进行音频处理，利用浏览器硬件加速
- 实现音频预加载机制，减少播放延迟
- 支持音频文件缓存，避免重复加载

### 6.2 音乐库扫描优化
- 实现增量扫描，只扫描新增或修改的文件
- 使用Worker线程进行扫描，避免阻塞主线程
- 实现扫描进度显示，提升用户体验

### 6.3 列表渲染优化
- 使用虚拟列表（如`react-window`）优化长列表渲染
- 实现列表项懒加载，只渲染可视区域内的项
- 优化列表项的重渲染，使用`React.memo`和`useMemo`

### 6.4 主题切换优化
- 使用CSS变量实现主题切换，避免全量重绘
- 实现主题缓存，减少主题加载时间
- 优化主题生成算法，提升从封面生成主题的速度

## 7. 安全设计

### 7.1 数据安全
- 本地数据库文件加密存储，防止未授权访问
- 用户配置信息加密保存
- 音频文件路径使用相对路径存储，避免暴露系统信息

### 7.2 网络安全
- 在线音乐API使用HTTPS加密传输
- 实现API请求限流，防止恶意请求
- 验证第三方API响应，防止注入攻击

### 7.3 代码安全
- 使用ESLint和TypeScript进行代码检查，避免常见错误
- 实现输入验证，防止XSS攻击
- 定期更新依赖，修复已知漏洞

## 8. 测试策略

### 8.1 单元测试
- 使用Jest进行单元测试，覆盖核心业务逻辑
- 测试音频播放控制、音乐库管理、播放列表管理等核心模块
- 测试工具函数和自定义Hooks

### 8.2 集成测试
- 使用Cypress进行集成测试，测试完整的用户流程
- 测试播放控制、音乐库扫描、播放列表编辑等功能流程
- 测试主题切换、歌词显示等交互功能

### 8.3 端到端测试
- 使用Electron Test Runner进行端到端测试
- 测试应用在不同操作系统上的表现
- 测试应用的安装、启动、运行和卸载流程

## 9. 版本控制与发布

### 9.1 版本号规则
使用语义化版本号（Semantic Versioning）：
- MAJOR版本：当你做了不兼容的API修改
- MINOR版本：当你添加了向后兼容的新功能
- PATCH版本：当你做了向后兼容的bug修复

### 9.2 发布流程
1. 代码提交和PR合并
2. 运行测试套件，确保所有测试通过
3. 更新版本号和CHANGELOG
4. 构建各平台安装包
5. 进行手动测试，确保功能正常
6. 发布安装包到官方网站和应用商店
7. 更新文档和发布说明

## 10. 维护与迭代

### 10.1 日志系统
- 实现应用日志记录，包括错误日志、操作日志和性能日志
- 支持日志级别配置（DEBUG、INFO、WARN、ERROR）
- 支持日志文件轮转和清理

### 10.2 监控系统
- 实现应用性能监控，包括CPU、内存使用情况
- 实现错误监控，自动收集和上报崩溃信息
- 实现用户行为分析，了解用户使用习惯

### 10.3 迭代计划
根据产品路线图，分阶段实现功能：
- V1.0：核心播放功能和本地音乐管理
- V2.0：在线音乐集成和智能推荐
- V3.0：高级音效和云同步功能

## 11. 总结

本技术架构设计文档详细描述了桌面端音乐播放器的技术栈选型、系统架构、核心模块设计、API设计和数据库设计等。设计遵循了分层架构原则，实现了高内聚低耦合，便于后续的扩展和维护。

架构设计考虑了性能优化、安全设计和测试策略，确保最终实现的产品具有良好的性能、安全性和可靠性。同时，设计也考虑了后续的迭代和维护，为产品的持续发展奠定了基础。

通过本架构设计，开发团队可以清晰地了解系统的整体结构和各个模块的实现细节，从而高效地进行开发和测试工作，最终交付一个高质量的桌面端音乐播放器产品。